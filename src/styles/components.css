@layer components {
  /* ============================================
     Card System
     ============================================ */

  .card-base {
    @apply rounded-[var(--radius-large)] overflow-hidden bg-[var(--card-bg)] transition-all;
  }

  .card-shadow {
    @apply drop-shadow-[0_2px_4px_rgba(0,0,0,0.005)];
  }

  /* ============================================
     Button System
     ============================================ */

  .btn-plain {
    @apply transition relative flex items-center justify-center bg-transparent
           text-black/75 hover:text-[var(--primary)]
           dark:text-white/75 dark:hover:text-[var(--primary)]
           hover:bg-[var(--btn-plain-bg-hover)]
           active:bg-[var(--btn-plain-bg-active)];
  }

  .btn-card {
    @apply transition flex items-center justify-center
           bg-[var(--card-bg)]
           hover:bg-[var(--btn-card-bg-hover)]
           active:bg-[var(--btn-card-bg-active)];
  }

  .btn-card.disabled {
    @apply pointer-events-none text-black/10 dark:text-white/10;
  }

  .btn-regular {
    @apply transition flex items-center justify-center
           bg-[var(--btn-regular-bg)]
           hover:bg-[var(--btn-regular-bg-hover)]
           active:bg-[var(--btn-regular-bg-active)]
           text-[var(--btn-content)] dark:text-white/75;
  }

  .btn-regular-dark {
    @apply flex items-center justify-center
           bg-[oklch(0.45_0.01_var(--hue))] hover:bg-[oklch(0.50_0.01_var(--hue))] active:bg-[oklch(0.55_0.01_var(--hue))]
           dark:bg-[oklch(0.30_0.02_var(--hue))] dark:hover:bg-[oklch(0.35_0.03_var(--hue))] dark:active:bg-[oklch(0.40_0.03_var(--hue))];
  }

  .btn-regular-dark.success {
    @apply bg-[oklch(0.75_0.14_var(--hue))] dark:bg-[oklch(0.75_0.14_var(--hue))];
  }

  /* ============================================
     Text Opacity Utilities
     ============================================ */

  .text-90 {
    @apply text-black/90 dark:text-white/90;
  }

  .text-75 {
    @apply text-black/75 dark:text-white/75;
  }

  .text-50 {
    @apply text-black/50 dark:text-white/50;
  }

  .text-30 {
    @apply text-black/30 dark:text-white/30;
  }

  .text-25 {
    @apply text-black/25 dark:text-white/25;
  }

  /* ============================================
     Link Styles
     ============================================ */

  .link-underline {
    @apply transition underline decoration-2 decoration-dashed
           decoration-[var(--link-underline)]
           hover:decoration-[var(--link-hover)]
           active:decoration-[var(--link-active)]
           underline-offset-[0.25rem];
  }

  /* ============================================
     Float Panel
     ============================================ */

  .float-panel {
    @apply rounded-[var(--radius-large)] overflow-hidden
           bg-[var(--float-panel-bg)]
           transition-all shadow-xl dark:shadow-none;
  }

  .float-panel-closed {
    @apply -translate-y-1 opacity-0 pointer-events-none;
  }

  /* ============================================
     Metadata & Icons
     ============================================ */

  .meta-icon {
    @apply w-8 h-8 transition rounded-md flex items-center justify-center
           bg-[var(--btn-regular-bg)] text-[var(--btn-content)] mr-2;
  }

  .with-divider {
    @apply before:content-['/'] before:ml-1.5 before:mr-1.5
           before:text-[var(--meta-divider)] before:text-sm
           before:font-medium before:first-of-type:hidden before:transition;
  }

  /* ============================================
     Table of Contents
     ============================================ */

  .toc-hide,
  .toc-not-ready {
    @apply opacity-0 pointer-events-none;
  }

  /* ============================================
     Scrollbar Utilities
     ============================================ */

  .hide-scrollbar {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .hide-scrollbar::-webkit-scrollbar {
    display: none;
  }
}

/* ============================================
   Animation Classes (Outside @layer)
   These use pseudo-elements and need to be
   defined outside @layer to work properly
   ============================================ */

.expand-animation {
  position: relative;
  z-index: 0;
}

.expand-animation::before {
  content: "";
  position: absolute;
  border-radius: inherit;
  inset: 0;
  scale: 0.85;
  z-index: -10;
  transition: scale 0.2s ease-out, background-color 0.2s ease-out;
}

.expand-animation:hover::before {
  scale: 1;
  background-color: var(--btn-plain-bg-hover);
}

.expand-animation:active::before {
  background-color: var(--btn-plain-bg-active);
}

.expand-animation:active {
  background: none;
}

.scale-animation {
  transition: transform 0.2s ease-out;
}

.scale-animation:active {
  transform: scale(0.9);
}

/* Special state for current theme button */
.btn-plain.scale-animation.current-theme-btn::before {
  scale: 1;
  opacity: 1;
  background-color: var(--btn-plain-bg-hover);
}

.btn-plain.scale-animation.current-theme-btn {
  color: var(--primary);
}

/* Link classes that use expand-animation */
.link {
  transition: all 0.2s ease-out;
  border-radius: 0.375rem;
  padding: 0.25rem;
  margin: -0.25rem;
  position: relative;
  z-index: 0;
}

.link::before {
  content: "";
  position: absolute;
  border-radius: inherit;
  inset: 0;
  scale: 0.85;
  z-index: -10;
  transition: scale 0.2s ease-out, background-color 0.2s ease-out;
}

.link:hover::before {
  scale: 1;
  background-color: var(--btn-plain-bg-hover);
}

.link:active::before {
  background-color: var(--btn-plain-bg-active);
}

.link-lg {
  transition: all 0.2s ease-out;
  border-radius: 0.375rem;
  padding: 0.375rem;
  margin: -0.375rem;
  position: relative;
  z-index: 0;
}

.link-lg::before {
  content: "";
  position: absolute;
  border-radius: inherit;
  inset: 0;
  scale: 0.85;
  z-index: -10;
  transition: scale 0.2s ease-out, background-color 0.2s ease-out;
}

.link-lg:hover::before {
  scale: 1;
  background-color: var(--btn-plain-bg-hover);
}

.link-lg:active::before {
  background-color: var(--btn-plain-bg-active);
}

/* ============================================
   Selection Style
   ============================================ */

::selection {
  background-color: var(--selection-bg);
}

/* ============================================
   Smooth Transitions on All Text Elements
   ============================================ */

h1, h2, h3, h4, h5, h6, p, a, span, li, ul, ol,
blockquote, code, pre, table, th, td, strong {
  transition: color 0.2s ease-out;
}

/* ============================================
   TOC Mask
   ============================================ */

#toc-inner-wrapper {
  mask-image: linear-gradient(to bottom, transparent 0%, black 2rem, black calc(100% - 2rem), transparent 100%);
}

/* ============================================
   Dash Line (for archive/timeline)
   ============================================ */

.dash-line {
  position: relative;
}

.dash-line::before {
  content: "";
  position: absolute;
  width: 10%;
  height: 100%;
  left: calc(50% - 1px);
  border-left: 2px dashed var(--line-color);
  pointer-events: none;
  transition: all 0.3s;
  transform: translateY(-50%);
}

/* ============================================
   Markdown Content Utilities
   ============================================ */

.custom-md img,
#post-cover img {
  cursor: zoom-in;
}

/* Spoiler element (hidden until hover) */
.custom-md spoiler {
  background-color: var(--codeblock-bg);
  padding: 0.125rem 0.25rem;
  overflow: hidden;
  border-radius: 0.375rem;
  transition: all 0.15s ease-out;
}

.custom-md spoiler:hover {
  background-color: transparent;
}

.custom-md spoiler:not(:hover) {
  color: var(--codeblock-bg);
}

.custom-md spoiler:not(:hover) * {
  color: var(--codeblock-bg);
}
